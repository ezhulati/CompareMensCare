---
import { getCollection } from 'astro:content';
import { categoryMatcherConfig } from '../data/categoryMatcherConfig';

interface Props {
  category: string;
  title?: string;
  description?: string;
}

const {
  category,
  title = "Find Your Perfect Match",
  description = "Get personalized recommendations in under 30 seconds"
} = Astro.props;

// Get configuration for this category
const config = categoryMatcherConfig[category] || categoryMatcherConfig['general'];

// Get all brands for server-side filtering
const allBrands = await getCollection('brands');
const categoryBrands = allBrands.filter(brand =>
  brand.data.categories.includes(category as any)
);

// Prepare brand data for client-side matching
const brandData = categoryBrands.map(brand => ({
  slug: brand.slug,
  title: brand.data.title,
  rating: brand.data.rating,
  reviewCount: brand.data.reviewCount || 0,
  affiliateId: brand.data.affiliateId,
  pricing: brand.data.pricing,
  priorities: brand.data.priorities || {},
  bestFor: brand.data.bestFor || [],
  pros: brand.data.pros,
  categories: brand.data.categories,
}));
---

<section class="embedded-matcher my-12 sm:my-16 bg-gradient-to-br from-blue-50/80 via-white to-blue-50/80 border border-blue-200/60 rounded-3xl p-6 sm:p-8 md:p-12 shadow-xl hover:shadow-2xl transition-shadow duration-300">
  <div class="max-w-5xl mx-auto">
    <!-- Header -->
    <div class="text-center mb-8 sm:mb-10">
      <div class="inline-block mb-4">
        <span class="bg-brand-accent/10 text-brand-accent text-xs sm:text-sm font-bold px-4 py-1.5 rounded-full uppercase tracking-wide">
          Personalized Recommendations
        </span>
      </div>
      <h2 class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold text-gray-900 mb-3 sm:mb-4 leading-tight">
        {title}
      </h2>
      <p class="text-base sm:text-lg md:text-xl text-gray-600 max-w-2xl mx-auto">
        {description}
      </p>
    </div>

    <!-- Progress Indicator -->
    <div class="flex items-center justify-center gap-2 sm:gap-3 mb-8 sm:mb-10" id="progress-indicator">
      <div class="flex items-center gap-2">
        <div class="step-indicator active" data-step="1">
          <span class="step-number">1</span>
        </div>
        <span class="hidden sm:inline text-sm font-medium text-gray-700">Your Need</span>
      </div>
      <div class="w-12 sm:w-16 h-0.5 bg-gray-300 step-connector" data-connector="1"></div>
      <div class="flex items-center gap-2">
        <div class="step-indicator" data-step="2">
          <span class="step-number">2</span>
        </div>
        <span class="hidden sm:inline text-sm font-medium text-gray-700">Priority</span>
      </div>
      <div class="w-12 sm:w-16 h-0.5 bg-gray-300 step-connector" data-connector="2"></div>
      <div class="flex items-center gap-2">
        <div class="step-indicator" data-step="3">
          <span class="step-number">3</span>
        </div>
        <span class="hidden sm:inline text-sm font-medium text-gray-700">Results</span>
      </div>
    </div>

    <!-- Matcher Container -->
    <div id="matcher-container">
      <!-- Step 1: Subcategory Selection -->
      <div id="step-1" class="matcher-step">
        <div class="text-center mb-6 sm:mb-8">
          <h3 class="text-xl sm:text-2xl md:text-3xl font-bold text-gray-900 mb-2">
            What are you looking for?
          </h3>
          <p class="text-sm sm:text-base text-gray-600">
            Choose the option that best describes your needs
          </p>
        </div>
        <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
          {config.subcategories.map((subcategory) => (
            <button
              type="button"
              class="subcategory-option p-4 sm:p-6 border-2 border-gray-300 rounded-2xl hover:border-brand-accent hover:bg-blue-50 focus:border-brand-accent focus:ring-2 focus:ring-brand-accent/20 transition-all text-left group relative overflow-hidden"
              data-subcategory={subcategory.id}
              aria-label={`Select ${subcategory.label}`}
            >
              <div class="relative z-10">
                <div class="font-bold text-base sm:text-lg text-gray-900 mb-1.5 group-hover:text-brand-accent transition-colors">
                  {subcategory.label}
                </div>
                {subcategory.description && (
                  <div class="text-xs sm:text-sm text-gray-600 leading-relaxed">
                    {subcategory.description}
                  </div>
                )}
              </div>
              <div class="absolute inset-0 bg-gradient-to-br from-brand-accent/0 to-brand-accent/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
            </button>
          ))}
        </div>
      </div>

      <!-- Step 2: Priority Selection -->
      <div id="step-2" class="matcher-step hidden">
        <button
          type="button"
          id="back-to-step-1"
          class="inline-flex items-center gap-2 text-brand-accent hover:text-blue-700 hover:underline mb-6 focus:outline-none focus:ring-2 focus:ring-brand-accent/20 rounded px-2 py-1 transition-all"
          aria-label="Go back to step 1"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
          <span class="font-medium">Back</span>
        </button>

        <div class="text-center mb-6 sm:mb-8">
          <h3 class="text-xl sm:text-2xl md:text-3xl font-bold text-gray-900 mb-2">
            What matters most to you?
          </h3>
          <p class="text-sm sm:text-base text-gray-600">
            We'll rank services based on your top priority
          </p>
        </div>

        <div class="grid sm:grid-cols-2 gap-3 sm:gap-4">
          {config.priorities.map((priority) => (
            <button
              type="button"
              class="priority-option p-4 sm:p-6 border-2 border-gray-300 rounded-2xl hover:border-brand-accent hover:bg-blue-50 focus:border-brand-accent focus:ring-2 focus:ring-brand-accent/20 transition-all text-left group relative overflow-hidden"
              data-priority={priority.id}
              aria-label={`Select ${priority.label}`}
            >
              <div class="flex items-start gap-3 sm:gap-4 relative z-10">
                <span class="text-3xl sm:text-4xl flex-shrink-0 group-hover:scale-110 transition-transform" aria-hidden="true">{priority.icon}</span>
                <div class="flex-1 min-w-0">
                  <div class="font-bold text-base sm:text-lg text-gray-900 mb-1.5 group-hover:text-brand-accent transition-colors">
                    {priority.label}
                  </div>
                  <div class="text-xs sm:text-sm text-gray-600 leading-relaxed">
                    {priority.description}
                  </div>
                </div>
              </div>
              <div class="absolute inset-0 bg-gradient-to-br from-brand-accent/0 to-brand-accent/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
            </button>
          ))}
        </div>
      </div>

      <!-- Step 3: Results -->
      <div id="step-3" class="matcher-step hidden">
        <div class="mb-6 sm:mb-8">
          <button
            type="button"
            id="back-to-step-2"
            class="inline-flex items-center gap-2 text-brand-accent hover:text-blue-700 hover:underline mb-4 focus:outline-none focus:ring-2 focus:ring-brand-accent/20 rounded px-2 py-1 transition-all"
            aria-label="Go back to step 2"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
            <span class="font-medium">Change Priority</span>
          </button>

          <div class="text-center sm:text-left">
            <h3 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 mb-2">
              Your Top Matches
            </h3>
            <p class="text-sm sm:text-base text-gray-600">
              Ranked by <span id="selected-priority-display" class="font-bold text-brand-accent"></span>
            </p>
          </div>
        </div>

        <!-- Loading State -->
        <div id="loading-results" class="text-center py-12">
          <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-gray-200 border-t-brand-accent"></div>
          <p class="mt-4 text-gray-600 font-medium">Finding your perfect matches...</p>
        </div>

        <!-- Results Container -->
        <div id="results-container" class="hidden space-y-4 sm:space-y-6">
          <!-- Results will be populated by JavaScript -->
        </div>

        <!-- No Results Message -->
        <div id="no-results" class="hidden text-center py-12 px-4">
          <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <h4 class="text-xl font-bold text-gray-900 mb-2">No matches found</h4>
          <p class="text-gray-600 mb-6">
            We couldn't find services matching your specific criteria. Try different options or view all services.
          </p>
          <button
            type="button"
            id="restart-matcher"
            class="inline-flex items-center gap-2 bg-brand-accent text-white font-semibold px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
            Start Over
          </button>
        </div>
      </div>
    </div>
  </div>
</section>

<script define:vars={{ brandData, config }}>
  // Matcher state
  let state = {
    subcategory: null,
    priority: null,
    currentStep: 1
  };

  // DOM elements
  const step1 = document.getElementById('step-1');
  const step2 = document.getElementById('step-2');
  const step3 = document.getElementById('step-3');
  const resultsContainer = document.getElementById('results-container');
  const loadingResults = document.getElementById('loading-results');
  const noResults = document.getElementById('no-results');
  const selectedPriorityDisplay = document.getElementById('selected-priority-display');

  // Step 1: Subcategory selection
  document.querySelectorAll('.subcategory-option').forEach(button => {
    button.addEventListener('click', () => {
      // Add selection feedback
      document.querySelectorAll('.subcategory-option').forEach(b => b.classList.remove('selected'));
      button.classList.add('selected');

      state.subcategory = button.getAttribute('data-subcategory');
      setTimeout(() => goToStep(2), 200);
    });

    // Keyboard navigation
    button.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        button.click();
      }
    });
  });

  // Step 2: Priority selection
  document.querySelectorAll('.priority-option').forEach(button => {
    button.addEventListener('click', () => {
      // Add selection feedback
      document.querySelectorAll('.priority-option').forEach(b => b.classList.remove('selected'));
      button.classList.add('selected');

      state.priority = button.getAttribute('data-priority');
      goToStep(3);
      setTimeout(() => showResults(), 300);
    });

    // Keyboard navigation
    button.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        button.click();
      }
    });
  });

  // Back buttons
  document.getElementById('back-to-step-1')?.addEventListener('click', () => {
    goToStep(1);
  });

  document.getElementById('back-to-step-2')?.addEventListener('click', () => {
    goToStep(2);
  });

  document.getElementById('restart-matcher')?.addEventListener('click', () => {
    state = { subcategory: null, priority: null, currentStep: 1 };
    goToStep(1);
  });

  // Navigate between steps
  function goToStep(stepNumber) {
    state.currentStep = stepNumber;

    // Hide all steps
    step1?.classList.add('hidden');
    step2?.classList.add('hidden');
    step3?.classList.add('hidden');

    // Show current step
    if (stepNumber === 1) {
      step1?.classList.remove('hidden');
    } else if (stepNumber === 2) {
      step2?.classList.remove('hidden');
    } else if (stepNumber === 3) {
      step3?.classList.remove('hidden');
      // Show loading state initially
      loadingResults?.classList.remove('hidden');
      resultsContainer?.classList.add('hidden');
      noResults?.classList.add('hidden');
    }

    // Update progress indicator
    updateProgressIndicator(stepNumber);

    // Scroll to top of matcher
    document.querySelector('.embedded-matcher')?.scrollIntoView({
      behavior: 'smooth',
      block: 'start'
    });

    // Focus management for accessibility
    setTimeout(() => {
      if (stepNumber === 1) {
        document.querySelector('.subcategory-option')?.focus();
      } else if (stepNumber === 2) {
        document.querySelector('.priority-option')?.focus();
      }
    }, 400);
  }

  // Update progress indicator
  function updateProgressIndicator(currentStep) {
    // Update step indicators
    document.querySelectorAll('.step-indicator').forEach((indicator, index) => {
      const step = index + 1;
      if (step < currentStep) {
        indicator.classList.add('completed');
        indicator.classList.remove('active');
      } else if (step === currentStep) {
        indicator.classList.add('active');
        indicator.classList.remove('completed');
      } else {
        indicator.classList.remove('active', 'completed');
      }
    });

    // Update connectors
    document.querySelectorAll('.step-connector').forEach((connector, index) => {
      const connectorStep = index + 1;
      if (connectorStep < currentStep) {
        connector.classList.add('completed');
      } else {
        connector.classList.remove('completed');
      }
    });
  }

  // Calculate and display results
  function showResults() {
    if (!state.priority) return;

    // Find priority label for display
    const priorityConfig = config.priorities.find(p => p.id === state.priority);
    if (priorityConfig && selectedPriorityDisplay) {
      selectedPriorityDisplay.textContent = priorityConfig.label;
    }

    // Filter and rank brands
    const rankedBrands = brandData
      .filter(brand => {
        // Has priority score
        return brand.priorities && brand.priorities[state.priority] !== undefined;
      })
      .map(brand => ({
        ...brand,
        score: brand.priorities[state.priority] || 0
      }))
      .sort((a, b) => b.score - a.score)
      .slice(0, 3); // Top 3

    // Simulate brief loading (feels more natural)
    setTimeout(() => {
      loadingResults?.classList.add('hidden');

      // Display results
      if (rankedBrands.length === 0) {
        resultsContainer?.classList.add('hidden');
        noResults?.classList.remove('hidden');
        return;
      }

      resultsContainer?.classList.remove('hidden');
      noResults?.classList.add('hidden');

      if (resultsContainer) {
        resultsContainer.innerHTML = rankedBrands.map((brand, index) => `
          <div class="result-card bg-white border-2 ${index === 0 ? 'border-brand-accent shadow-lg' : 'border-gray-200'} rounded-2xl p-5 sm:p-6 md:p-8 hover:shadow-xl transition-all relative group">
            ${index === 0 ? `
              <div class="absolute -top-3 left-4 sm:left-6 bg-gradient-to-r from-brand-accent to-blue-600 text-white text-xs font-bold px-4 py-1.5 rounded-full shadow-md flex items-center gap-1">
                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                </svg>
                Best Match
              </div>
            ` : ''}

            <div class="mb-5 sm:mb-6">
              <div class="flex items-start gap-2 sm:gap-3 mb-3">
                <span class="text-2xl sm:text-3xl md:text-4xl font-black text-gray-300 leading-none">#${index + 1}</span>
                <div class="flex-1 min-w-0">
                  <h4 class="text-xl sm:text-2xl md:text-3xl font-bold text-gray-900 mb-2 group-hover:text-brand-accent transition-colors break-words">${brand.title}</h4>

                  <div class="flex flex-wrap items-center gap-2 sm:gap-3 mb-3">
                    <div class="flex items-center gap-1">
                      ${generateStars(brand.rating)}
                      <span class="text-sm sm:text-base font-bold text-gray-900 ml-1">${brand.rating.toFixed(1)}</span>
                    </div>
                    ${brand.reviewCount > 0 ? `
                      <span class="text-xs sm:text-sm text-gray-500">(${brand.reviewCount.toLocaleString()} reviews)</span>
                    ` : ''}
                  </div>
                </div>
              </div>

              ${priorityConfig ? `
                <div class="inline-flex items-center gap-2 sm:gap-3 bg-gradient-to-r from-blue-50 to-blue-100 px-3 sm:px-4 py-2 rounded-xl mb-4 border border-blue-200">
                  <span class="text-xl sm:text-2xl">${priorityConfig.icon}</span>
                  <div class="flex flex-col">
                    <span class="text-xs font-semibold text-gray-600 uppercase tracking-wide">${priorityConfig.label}</span>
                    <span class="text-lg sm:text-xl font-black text-brand-accent">${brand.score.toFixed(1)}<span class="text-sm font-normal text-gray-500">/10</span></span>
                  </div>
                </div>
              ` : ''}
            </div>

            ${brand.pros && brand.pros.length > 0 ? `
              <div class="mb-6">
                <h5 class="text-sm sm:text-base font-bold text-gray-900 mb-3">Why We Recommend:</h5>
                <ul class="space-y-2">
                  ${brand.pros.slice(0, 3).map(pro => `
                    <li class="flex items-start gap-2 text-sm sm:text-base text-gray-700">
                      <svg class="w-4 h-4 sm:w-5 sm:h-5 text-medical-green-500 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                      </svg>
                      <span class="flex-1">${pro}</span>
                    </li>
                  `).join('')}
                </ul>
              </div>
            ` : ''}

            <div class="flex flex-col sm:flex-row items-start sm:items-end justify-between gap-4 pt-5 sm:pt-6 border-t-2 border-gray-100">
              <div class="flex-shrink-0">
                <span class="text-xs sm:text-sm text-gray-500 font-medium uppercase tracking-wide">Starting at</span>
                <div class="text-2xl sm:text-3xl md:text-4xl font-black text-gray-900 font-mono leading-none my-1">
                  ${brand.pricing.medicationFrom || brand.pricing.consultationFee}
                </div>
                <span class="text-xs sm:text-sm text-gray-500">${brand.pricing.subscriptionType}</span>
              </div>
              <div class="flex flex-col gap-2 sm:gap-3 w-full sm:w-auto">
                <a
                  href="/go/${brand.affiliateId}"
                  class="affiliate-button bg-gradient-to-r from-brand-accent to-blue-600 text-white font-bold px-5 sm:px-8 py-3 sm:py-4 rounded-xl hover:from-blue-600 hover:to-blue-700 focus:ring-4 focus:ring-brand-accent/20 transition-all text-center shadow-md hover:shadow-xl transform hover:-translate-y-0.5 text-sm sm:text-base"
                  rel="nofollow sponsored"
                >
                  Visit ${brand.title} →
                </a>
                <a
                  href="/${brand.slug}"
                  class="text-xs sm:text-sm text-brand-accent hover:text-blue-700 hover:underline text-center font-medium transition-colors"
                >
                  Read full review
                </a>
              </div>
            </div>
          </div>
        `).join('');
      }
    }, 800);
  }

  // Generate star rating HTML
  function generateStars(rating) {
    const fullStars = Math.floor(rating);
    const halfStar = rating % 1 >= 0.5;
    const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);

    let stars = '';

    // Full stars
    for (let i = 0; i < fullStars; i++) {
      stars += `<svg class="w-4 h-4 sm:w-5 sm:h-5 text-yellow-500" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>`;
    }

    // Half star
    if (halfStar) {
      stars += `<svg class="w-4 h-4 sm:w-5 sm:h-5 text-yellow-500" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>`;
    }

    // Empty stars
    for (let i = 0; i < emptyStars; i++) {
      stars += `<svg class="w-4 h-4 sm:w-5 sm:h-5 text-gray-300" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>`;
    }

    return stars;
  }
</script>

<style>
  .matcher-step {
    animation: fadeInUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .subcategory-option,
  .priority-option {
    position: relative;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .subcategory-option:hover,
  .priority-option:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 24px rgba(0, 102, 204, 0.15);
  }

  .subcategory-option:active,
  .priority-option:active {
    transform: translateY(-1px);
  }

  .subcategory-option.selected,
  .priority-option.selected {
    border-color: #0066CC;
    background: #EFF6FF;
    transform: translateY(-2px);
  }

  .result-card {
    animation: slideInLeft 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }

  @keyframes slideInLeft {
    from {
      opacity: 0;
      transform: translateX(-30px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  /* Progress Indicator Styles */
  .step-indicator {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: white;
    border: 3px solid #D1D5DB;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    position: relative;
  }

  .step-indicator.active {
    border-color: #0066CC;
    background: #0066CC;
  }

  .step-indicator.completed {
    border-color: #059669;
    background: #059669;
  }

  .step-number {
    font-size: 16px;
    font-weight: 700;
    color: #6B7280;
  }

  .step-indicator.active .step-number,
  .step-indicator.completed .step-number {
    color: white;
  }

  .step-indicator.completed::after {
    content: "✓";
    position: absolute;
    color: white;
    font-weight: bold;
    font-size: 20px;
  }

  .step-indicator.completed .step-number {
    display: none;
  }

  .step-connector {
    transition: all 0.3s ease;
  }

  .step-connector.completed {
    background: #059669;
  }

  /* Mobile optimizations */
  @media (max-width: 640px) {
    .embedded-matcher {
      border-radius: 1.5rem;
    }

    .step-indicator {
      width: 32px;
      height: 32px;
    }

    .step-number {
      font-size: 14px;
    }

    .step-indicator.completed::after {
      font-size: 16px;
    }
  }
</style>
