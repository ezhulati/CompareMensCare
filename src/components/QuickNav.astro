---
interface Props {
  sections: {
    id: string;
    label: string;
    icon?: string;
  }[];
}

const { sections } = Astro.props;
---

<nav class="quick-nav sticky top-0 z-40 bg-white/95 backdrop-blur-sm border-b border-gray-200 shadow-sm">
  <div class="container-custom mx-auto px-4">
    <div class="flex items-center gap-2 overflow-x-auto scrollbar-hide py-3">
      <span class="text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap mr-2">
        Jump to:
      </span>
      {sections.map((section) => (
        <a
          href={`#${section.id}`}
          class="quick-nav-link px-4 py-2 text-sm font-medium text-gray-700 hover:text-brand-accent hover:bg-blue-50 rounded-full transition-all whitespace-nowrap border border-transparent hover:border-blue-200"
          data-section={section.id}
        >
          {section.icon && (
            <span class="inline-block mr-1.5" aria-hidden="true">{section.icon}</span>
          )}
          {section.label}
        </a>
      ))}
    </div>
  </div>
</nav>

<style>
  /* Hide scrollbar for Chrome, Safari and Opera */
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }

  /* Hide scrollbar for IE, Edge and Firefox */
  .scrollbar-hide {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }

  /* Active state */
  .quick-nav-link.active {
    @apply text-white bg-brand-accent border-brand-accent;
  }

  /* Smooth scroll */
  html {
    scroll-behavior: smooth;
  }
</style>

<script>
  // Intersection Observer to track active section
  const sections = document.querySelectorAll('[id]');
  const navLinks = document.querySelectorAll('.quick-nav-link');

  const observerOptions = {
    root: null,
    rootMargin: '-100px 0px -66%',
    threshold: 0
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        const id = entry.target.getAttribute('id');

        // Remove active class from all links
        navLinks.forEach((link) => {
          link.classList.remove('active');
        });

        // Add active class to current link
        const activeLink = document.querySelector(`.quick-nav-link[data-section="${id}"]`);
        if (activeLink) {
          activeLink.classList.add('active');
        }
      }
    });
  }, observerOptions);

  // Observe all sections that have IDs matching our nav links
  const navLinkIds = Array.from(navLinks).map(link => link.getAttribute('data-section'));
  sections.forEach((section) => {
    const sectionId = section.getAttribute('id');
    if (sectionId && navLinkIds.includes(sectionId)) {
      observer.observe(section);
    }
  });

  // Smooth scroll with offset for sticky header
  navLinks.forEach((link) => {
    link.addEventListener('click', (e) => {
      e.preventDefault();
      const targetId = link.getAttribute('href')?.substring(1);
      const targetSection = document.getElementById(targetId || '');

      if (targetSection) {
        const navElement = document.querySelector('.quick-nav') as HTMLElement;
        const navHeight = navElement?.offsetHeight || 0;
        const targetPosition = targetSection.offsetTop - navHeight - 20;

        window.scrollTo({
          top: targetPosition,
          behavior: 'smooth'
        });
      }
    });
  });
</script>
